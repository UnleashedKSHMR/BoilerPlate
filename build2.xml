<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="runTest" name="HeadinfotechAutomation" xmlns:ivy="antlib:org.apache.ivy.ant">

	<property name="src" location="./src" />
	<property name="bin" location="./bin" />
	<property name="lib" location="./lib" />
	<property name="browser" location="C:/Program Files/Mozilla Firefox/firefox.exe" />
	<property name="webdriver.firefox.profile" value="default" />
	<property environment="env" />
	<property file="resources/dataconfig.properties" />
	<property name="ivy.install.version" value="2.4.0" />
	<property name="ivy.jar.dir" value="${ant.library.dir}" />
	<property name="ivy.jar.file" value="${ivy.jar.dir}/ivy.jar" />
	<tstamp>
		<format property="run.time" pattern="dd_MMM_yyyy_hh_mm_ss_SSS_aa" />
	</tstamp>
	
	<!-- ====== Set the classpath ====  -->
		<path id="classpath">
			<pathelement location="${bin}" />
			<fileset dir="${lib}">
				<include name="*.jar" />
			</fileset>
		</path>

	<target name="init" >
		<echo message="init: Creating bin directory" />
		<mkdir dir="${bin}" />
	</target>

	<target name="clean">
		<echo message="clean: deleting existing bin directory" />
		<delete dir="${bin}" />
	</target>

	<target name="compile" depends="clean,init">
		<echo message="classpath:${test.classpath}" />
		<echo message="compiling.........." />
		<javac destdir="${bin}" srcdir="${src}" classpathref="classpath" encoding ="iso-8859-1" includeantruntime="false" debug="true" debuglevel="lines,source" />
	</target>
	<taskdef name="testng" classname="org.testng.TestNGAntTask" classpathref="classpath">	
	</taskdef>
	<target name="runTest" depends="compile">
		<echo message="running test..." />
		<taskdef resource="testngtasks" classpathref="classpath" />
		<testng classpathref="classpath" outputdir="${test.results.dir}//${run.time}" haltonfailure="false" useDefaultListeners="false">
			<xmlfileset dir="${basedir}" includes="testng.xml" />
			<sysproperty key="outputDir" value="${test.results.dir}/${run.time}/html" />
			<sysproperty key="selenium.screenshots.dir" value="${test.results.dir}/${run.time}/img/" />
			<sysproperty key="selenium.screenshots.relative.path" value="../img" />
			<sysproperty key="org.uncommons.reportng.title" value="${report.title}" />
			<sysproperty key="browser" value="chrome" />
		</testng>
	</target>
	<!-- below code is not working-->
	<target name="openReport">
		<echo message="Opening report...." />
		<exec executable="${browser}" spawn="yes">
			<arg line="'${test.results.dir}/${run.time}/html/index.html'" />
		</exec>
	</target>
</project>